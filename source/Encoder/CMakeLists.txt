cmake_minimum_required(VERSION 3.14 FATAL_ERROR)

create_tmiv_library(
    TARGET
        EncoderLib
    SOURCES
        "src/Configuration.cpp"    
        "src/Encoder.cpp"
        "src/Encoder_assessColorConsistency.cpp"
        "src/Encoder_prepareSequence.cpp"
        "src/Encoder_prepareAccessUnit.cpp"
        "src/Encoder_pushFrame.cpp"
        "src/Encoder_completeAccessUnit.cpp"
        "src/Encoder_popFrame.cpp"
        "src/GeometryQuantizer.cpp"
        "src/GeometryDownscaler.cpp"
        "src/MivEncoder.cpp"
        "src/FramePacker.cpp"
    PUBLIC
        TMIV::ViewOptimizerLib
        TMIV::PrunerLib
        TMIV::AggregatorLib
        TMIV::PackerLib
        TMIV::DepthQualityAssessorLib
    )

create_tmiv_executable(
    TARGET
        Encoder
    SOURCES
        "src/Encoder.main.cpp"
        "src/registerComponents.cpp"
    PRIVATE
        TMIV::EncoderLib
        TMIV::IOLib
    )

create_tmiv_executable(
    TARGET
        MpiEncoder
    SOURCES
        "src/MpiEncoder.cpp"
        "src/MpiEncoder.main.cpp"
        "src/registerComponents.cpp"
    PRIVATE
        TMIV::EncoderLib
        TMIV::MpiPcsLib
    )

create_tmiv_library(
    TARGET
        MultiplexerLib
    SOURCES
        "src/Multiplexer.cpp"
    PUBLIC
        TMIV::MivBitstreamLib
)

create_catch2_unit_test(
    TARGET
        MultiplexerTest
    SOURCES
        "src/Multiplexer.test.cpp"
    PRIVATE
        TMIV::MultiplexerLib
)

create_tmiv_executable(
    TARGET
        Multiplexer
    SOURCES
        "src/Multiplexer.main.cpp"
    PRIVATE
        TMIV::MultiplexerLib
        TMIV::IOLib
    )

create_catch2_unit_test(
    TARGET
        EncoderTest
    SOURCES
        "src/AnnexB.test.cpp"
        "src/ColorConsistencyAssessor.test.cpp"
        "src/Configuration.test.cpp"
        "src/Encoder_prepareSequence.test.cpp"
        "src/ExplicitOccupancy.test.cpp"
        "src/FramePacker.test.cpp"
        "src/GeometryQuantizer.test.cpp"
        "src/MivEncoder.test.cpp"
    PRIVATE
        TMIV::EncoderLib
    )
