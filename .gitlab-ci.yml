stages:
  - build
  - test

gcc-9:
  stage: build
  image: rikorose/gcc-cmake:gcc-9
  tags:
    - linux
  script:
    - mkdir -p build && cd build
    - cmake -DCMAKE_CXX_FLAGS="-Wall -Wextra -Wpedantic -Werror" -DENABLE_CLANG_TIDY=OFF ..
    - make -j $(nproc)

clang-11:
  stage: build
  image: cbachhuber/clang:11
  tags:
    - linux
  # only:  # TODO enable when opening MR
    # - merge_requests
    # - v7.0-dev
  script:
    - mkdir -p build && cd build
    - cmake -DCMAKE_CXX_FLAGS="-Wall -Wextra -Wpedantic -Werror" ..
    - make -j $(nproc)
  artifacts:
      untracked: true
      expire_in: 3 days
      paths:
          - build/

ctest:
  stage: test
  image: ubuntu:20.04
  tags:
    - linux
  # needs:  # TODO fix
    # - job: clang-11
      # artifacts: true
  script:
    - export DEBIAN_FRONTEND=noninteractive
    - apt-get update -qy
    - apt-get install -y cmake
    - cd build
    - ls -la
    - ctest
