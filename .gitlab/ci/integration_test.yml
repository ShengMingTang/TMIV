Integration Test:
  stage: integration
  image: buildtools2019:2021.04.14
  tags: [ windows, integration_test ]
  rules:
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: always
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: manual
  script:
    - >
      python scripts/test/integration_test.py
      /builds/software/MPEG/MIV/RS/TM1/install
      /builds/software/MPEG/MIV/RS/TM1
      /tmiv_integration_test
      /builds/software/MPEG/MIV/RS/TM1/integration_test
      -r /builds/software/MPEG/MIV/RS/TM1/test/ci_integration_test.md5
      -j 3 --ci
  artifacts:
    when: always
    paths:
      - integration_test/**/*.hls
      - integration_test/**/*.json
      - integration_test/**/*.log
      - integration_test/**/*.md5
